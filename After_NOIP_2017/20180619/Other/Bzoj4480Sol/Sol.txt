Bzoj4480: [Jsoi2013]快乐的jyy 广义后缀自动机 倍增 哈希 manacher

就是不学回文自动机(雾)

国际惯例的题面:

有人说这是回文自动机的板子题，然而我是不会这种东西的。
于是，我选择用更一般性的方法去解决这个题，就是那一堆东西了。
首先，我们把两个串同时插入一个广义SAM里，拓扑排序维护每个节点的parent树的子树中来自两个串的right集合的大小sizA和sizB。
同时倍增求出parent树上每个节点向上2^k层的父亲是哪个节点。
显然一个串本质不同的回文串数量是O(n)的(什么你不知道？manacher的复杂度怎么证的？)，我们对A串做manacher，在暴力拓展的时候，去后缀自动机上倍增查询这个包含这个串的最浅的节点(显然这个节点的right集合最大)，这个串对答案的贡献就是这个节点的sizA*sizB了。
为了防止同样的串被统计多次，我们需要哈希和unordered_set去重。
这个题的广义SAM在建立的时候，无论如何要新建节点，不能走已有的节点，否则会导致一些节点的len变小，出现一些不合法的情况。
总体时间复杂度O(nlogn)，由于这种做法常数较大，所以BZOJ光荣垫底(然而AC这题还是绰绰有余的)。

代码:


この校舎がつくる影
教学楼所组成的影子
待ち合わせした音楽室
在音乐教室中等候
屋上から見えた 流れてくひこうき雲
从屋顶上看到的划过天际的飞行云
まだ残ってる落書き
还残留着的涂鸦
この瞳に映るすべて
映入眼帘的一切
伝えたい ひとつひとつに
想要传达 一个一个
想い出溢れること
满溢的思念
部室の窓から探してた
从活动室窗户寻找
遠くても君なら すぐにみつけられる
即使多么遥远你也立刻找出
